<!--
APP_NAME: Petra Chrumky
APP_DESCRIPTION: Etess Petr√°t finom chrumkival √©s n√∂veld a j√≥kedv√©t!
APP_ICON: https://raw.githubusercontent.com/Marcangali/gemini_96_os/main/Studio_App/PetraChrumky_1764499233307/icon.png
WINDOW_WIDTH: 380
WINDOW_HEIGHT: 620
STORE_ID: petra-chrumky-sim
-->
<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Petra Chrumky Ev≈ë Szimul√°tor</title>
    <style>
        :root {
            --bg-color: #f3f3f3;
            --surface-color: #ffffff;
            --primary-color: #ff9f43; /* Chrumky orange */
            --primary-hover: #ff8e29;
            --text-color: #333333;
            --accent-color: #ff6b6b;
            --border-radius: 12px;
            --shadow: 0 4px 12px rgba(0,0,0,0.08);
            --font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            --skin-color: #ffdbac;
            --hair-color: #4a3228;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            font-family: var(--font-family);
            color: var(--text-color);
            overflow: hidden;
            user-select: none;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Mobile Mode Override */
        body.mobile-mode {
            font-size: 18px;
        }
        body.mobile-mode .chrumky-btn {
            height: 100px;
        }

        .app-header {
            padding: 15px;
            background: var(--surface-color);
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            text-align: center;
            z-index: 10;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .app-title {
            font-size: 16px;
            font-weight: 700;
            margin: 0;
            color: #444;
        }

        .score-display {
            background: #fff3e0;
            color: #e65100;
            padding: 5px 12px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 14px;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
        }

        .main-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        /* --- Petra Character Art --- */
        .character-container {
            position: relative;
            width: 180px;
            height: 180px;
            margin-top: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* Head Base */
        .head {
            position: relative;
            width: 140px;
            height: 150px;
            background-color: var(--skin-color);
            border-radius: 60px 60px 80px 80px; /* Chin shape */
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            z-index: 5;
            transition: transform 0.1s ease-out;
        }

        /* Hair - Back */
        .hair-back {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 170px;
            height: 160px;
            background-color: var(--hair-color);
            border-radius: 80px 80px 40px 40px;
            z-index: 1;
        }

        /* Hair - Bangs */
        .hair-bangs {
            position: absolute;
            top: -5px;
            left: 50%;
            transform: translateX(-50%);
            width: 150px;
            height: 70px;
            background-color: var(--hair-color);
            border-radius: 70px 70px 10px 10px;
            z-index: 6;
            clip-path: polygon(0 0, 100% 0, 95% 80%, 80% 60%, 50% 90%, 20% 60%, 5% 80%);
        }

        /* Ears */
        .ear {
            position: absolute;
            top: 60px;
            width: 20px;
            height: 30px;
            background-color: var(--skin-color);
            border-radius: 50%;
            z-index: 2;
        }
        .ear.left { left: 10px; }
        .ear.right { right: 10px; }

        /* Face Features */
        .face-features {
            position: relative;
            top: 60px;
            width: 100%;
            height: 100%;
            z-index: 7;
        }

        .eyes {
            display: flex;
            justify-content: center;
            gap: 36px;
        }

        .eye {
            width: 14px;
            height: 14px;
            background-color: #2d1e18;
            border-radius: 50%;
            position: relative;
            transition: all 0.2s;
        }

        /* Eye Shine */
        .eye::after {
            content: '';
            position: absolute;
            top: 3px;
            right: 3px;
            width: 4px;
            height: 4px;
            background: white;
            border-radius: 50%;
        }

        .cheeks {
            display: flex;
            justify-content: center;
            gap: 50px;
            margin-top: 5px;
        }
        .cheek {
            width: 20px;
            height: 10px;
            background: rgba(255, 107, 107, 0.2);
            border-radius: 50%;
        }

        .nose {
            width: 6px;
            height: 4px;
            background: rgba(0,0,0,0.1);
            border-radius: 50%;
            margin: -5px auto 0 auto;
        }

        .mouth {
            width: 24px;
            height: 4px;
            background: #4a3228;
            border-radius: 10px;
            margin: 10px auto;
            transition: all 0.1s ease;
        }

        /* States */
        .head.chewing {
            animation: chew 0.15s infinite alternate;
        }

        .head.chewing .mouth {
            height: 12px;
            width: 22px;
            border-radius: 50%;
            background: #5d4037;
            border: 2px solid #3e2723;
        }

        @keyframes chew {
            0% { transform: scaleY(1); }
            100% { transform: scaleY(0.98) translateY(2px); }
        }

        /* Mood variants */
        [data-mood="happy"] .mouth { width: 30px; height: 12px; border-bottom-left-radius: 15px; border-bottom-right-radius: 15px; background: #6d4c41; }
        [data-mood="very-happy"] .eye { transform: scaleX(1.3) scaleY(0.3); } /* Squint */
        [data-mood="very-happy"] .mouth { width: 36px; height: 18px; border-radius: 0 0 20px 20px; background: #d32f2f; }
        [data-mood="euphoric"] .head { animation: float 2s infinite ease-in-out; box-shadow: 0 0 25px rgba(255, 215, 0, 0.6); }
        [data-mood="euphoric"] .mouth { width: 40px; height: 26px; border-radius: 50%; background: #c62828; }

        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-8px); } }


        /* --- Controls --- */
        .chrumky-btn {
            background: linear-gradient(135deg, #ffd54f 0%, #ffca28 100%);
            border: none;
            width: 100%;
            max-width: 280px;
            height: 80px;
            border-radius: var(--border-radius);
            font-size: 20px;
            font-weight: 800;
            color: #5d4037;
            cursor: pointer;
            box-shadow: 0 6px 0 #ffa000, 0 10px 10px rgba(0,0,0,0.1);
            transition: all 0.1s;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            outline: none;
        }

        .chrumky-btn:active {
            transform: translateY(6px);
            box-shadow: 0 0 0 #ffa000, 0 4px 4px rgba(0,0,0,0.1);
        }

        .chrumky-icon {
            font-size: 28px;
        }

        /* --- Shop --- */
        .shop-container {
            width: 100%;
            background: var(--surface-color);
            border-radius: var(--border-radius);
            padding: 15px;
            box-shadow: var(--shadow);
            flex: 1;
            overflow-y: auto;
        }

        .shop-title {
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #888;
            margin-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 5px;
        }

        .shop-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #f0f0f0;
            transition: background 0.2s;
            cursor: pointer;
            border-radius: 8px;
        }

        .shop-item:hover {
            background: #fff8e1;
        }
        
        .shop-item.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            filter: grayscale(1);
        }

        .item-info h4 { margin: 0; font-size: 15px; }
        .item-info p { margin: 2px 0 0; font-size: 12px; color: #666; }
        
        .buy-btn {
            background: #4caf50;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: bold;
        }

        /* Particles */
        .particle {
            position: absolute;
            pointer-events: none;
            animation: fly 0.8s ease-out forwards;
            font-weight: bold;
            color: #ff9f43;
            z-index: 100;
        }

        @keyframes fly {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 1; }
            100% { transform: translate(-50%, -150px) scale(1.5); opacity: 0; }
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #ddd; border-radius: 3px; }

    </style>
</head>
<body>

    <div class="app-header">
        <div class="app-title">Petra Chrumky Szimul√°tor</div>
        <div class="score-display">J√≥kedv: <span id="score">0</span></div>
    </div>

    <div class="main-container">
        
        <!-- Enhanced Petra Character -->
        <div class="character-container">
            <div class="hair-back"></div>
            <div class="ear left"></div>
            <div class="ear right"></div>
            <div class="head" id="petra-head">
                <div class="hair-bangs"></div>
                <div class="face-features">
                    <div class="eyes">
                        <div class="eye left"></div>
                        <div class="eye right"></div>
                    </div>
                    <div class="nose"></div>
                    <div class="cheeks">
                        <div class="cheek"></div>
                        <div class="cheek"></div>
                    </div>
                    <div class="mouth"></div>
                </div>
            </div>
        </div>
        <div style="font-size: 12px; color: #888; margin-top: -10px;">Hangulat: <span id="mood-text">Semleges</span></div>

        <!-- Action -->
        <button class="chrumky-btn" id="eat-btn">
            <span class="chrumky-icon">ü•ú</span> ENNI!
        </button>

        <!-- Upgrades -->
        <div class="shop-container">
            <div class="shop-title">Chrumky Bolt (Fejleszt√©sek)</div>
            <div id="shop-list">
                <!-- Shop items will be injected here -->
            </div>
        </div>

    </div>

    <script>
        // --- Enhanced Audio System (Web Audio API) ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        // Better Crunch Sound synthesis
        function playCrunchSound() {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            
            const t = audioCtx.currentTime;

            // Create a buffer for noise
            const duration = 0.2;
            const bufferSize = audioCtx.sampleRate * duration;
            const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
            const data = buffer.getChannelData(0);

            // Fill with noise (simple white noise)
            for (let i = 0; i < bufferSize; i++) {
                data[i] = Math.random() * 2 - 1;
            }

            // Node 1: High frequency snap (The "Crack")
            const snapSource = audioCtx.createBufferSource();
            snapSource.buffer = buffer;
            // Randomize pitch slightly
            snapSource.playbackRate.value = 0.8 + Math.random() * 0.4;
            
            const snapFilter = audioCtx.createBiquadFilter();
            snapFilter.type = 'highpass';
            snapFilter.frequency.value = 1500;

            const snapGain = audioCtx.createGain();
            snapGain.gain.setValueAtTime(0.5, t);
            snapGain.gain.exponentialRampToValueAtTime(0.01, t + 0.1);

            // Node 2: Low frequency crunch (The body)
            const bodySource = audioCtx.createBufferSource();
            bodySource.buffer = buffer;
            bodySource.playbackRate.value = 0.6 + Math.random() * 0.2;

            const bodyFilter = audioCtx.createBiquadFilter();
            bodyFilter.type = 'lowpass';
            bodyFilter.frequency.value = 800;

            const bodyGain = audioCtx.createGain();
            bodyGain.gain.setValueAtTime(0.6, t);
            bodyGain.gain.exponentialRampToValueAtTime(0.01, t + 0.2);

            // Connect graph
            snapSource.connect(snapFilter);
            snapFilter.connect(snapGain);
            snapGain.connect(audioCtx.destination);

            bodySource.connect(bodyFilter);
            bodyFilter.connect(bodyGain);
            bodyGain.connect(audioCtx.destination);

            snapSource.start();
            bodySource.start();
        }

        function playBuySound() {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();

            osc.type = 'sine';
            osc.frequency.setValueAtTime(400, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(800, audioCtx.currentTime + 0.1);

            gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);

            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.3);
        }

        // --- Game State ---
        const gameState = {
            happiness: 0,
            clickPower: 1,
            upgrades: [
                { id: 1, name: "S√≥s Chrumky", cost: 15, power: 1, count: 0, icon: "üßÇ" },
                { id: 2, name: "Mogyor√≥s Chrumky", cost: 100, power: 5, count: 0, icon: "ü•ú" },
                { id: 3, name: "Sajtos Chrumky", cost: 500, power: 15, count: 0, icon: "üßÄ" },
                { id: 4, name: "Pizza Chrumky", cost: 2000, power: 50, count: 0, icon: "üçï" },
                { id: 5, name: "Arany Chrumky", cost: 10000, power: 200, count: 0, icon: "‚ú®" }
            ]
        };

        // --- DOM Elements ---
        const scoreEl = document.getElementById('score');
        const petraHeadEl = document.getElementById('petra-head');
        const moodTextEl = document.getElementById('mood-text');
        const eatBtn = document.getElementById('eat-btn');
        const shopListEl = document.getElementById('shop-list');

        // --- Core Logic ---

        function updateMood() {
            let mood = "neutral";
            let label = "Semleges";

            if (gameState.happiness > 5000) { mood = "euphoric"; label = "Euf√≥rikus!"; }
            else if (gameState.happiness > 1000) { mood = "very-happy"; label = "Nagyon Boldog"; }
            else if (gameState.happiness > 200) { mood = "happy"; label = "Boldog"; }
            else if (gameState.happiness > 50) { mood = "neutral"; label = "El√©gedett"; }
            else { mood = "neutral"; label = "√âhes"; }

            petraHeadEl.setAttribute('data-mood', mood);
            moodTextEl.textContent = label;
        }

        function createParticle(x, y, text) {
            const el = document.createElement('div');
            el.className = 'particle';
            el.textContent = `+${text}`;
            el.style.left = x + 'px';
            el.style.top = y + 'px';
            document.body.appendChild(el);
            setTimeout(() => el.remove(), 800);
        }

        function renderShop() {
            shopListEl.innerHTML = '';
            gameState.upgrades.forEach(item => {
                const el = document.createElement('div');
                const canAfford = gameState.happiness >= item.cost;
                
                el.className = `shop-item ${canAfford ? '' : 'disabled'}`;
                el.onclick = () => buyItem(item);
                
                el.innerHTML = `
                    <div style="font-size: 24px; margin-right: 10px;">${item.icon}</div>
                    <div class="item-info" style="flex:1">
                        <h4>${item.name}</h4>
                        <p>+${item.power} / klikk</p>
                    </div>
                    <button class="buy-btn" style="background: ${canAfford ? '#4caf50' : '#ccc'}">
                        ${item.cost}
                    </button>
                `;
                shopListEl.appendChild(el);
            });
        }

        function buyItem(item) {
            if (gameState.happiness >= item.cost) {
                gameState.happiness -= item.cost;
                gameState.clickPower += item.power;
                item.count++;
                item.cost = Math.floor(item.cost * 1.5);
                playBuySound();
                updateUI();
            }
        }

        function updateUI() {
            scoreEl.textContent = Math.floor(gameState.happiness);
            updateMood();
            renderShop();
        }

        // --- Interactions ---

        eatBtn.addEventListener('mousedown', (e) => {
            // Visual Animation
            petraHeadEl.classList.add('chewing');
            // Remove class after animation
            setTimeout(() => petraHeadEl.classList.remove('chewing'), 150);
            
            // Logic
            gameState.happiness += gameState.clickPower;
            
            // Audio
            playCrunchSound();

            // Particles
            const rect = eatBtn.getBoundingClientRect();
            const x = rect.left + rect.width / 2 + (Math.random() * 40 - 20);
            const y = rect.top;
            createParticle(x, y, gameState.clickPower);

            updateUI();
        });
        
        // Touch support for mobile (prevents delay)
        eatBtn.addEventListener('touchstart', (e) => {
            e.preventDefault(); // Stop mouse emulation
            eatBtn.dispatchEvent(new Event('mousedown'));
        });

        // Responsiveness Check
        function checkMobile() {
            if (document.body.clientWidth < 400 || document.body.classList.contains('mobile-mode')) {
                // CSS media queries handle mostly, but JS logic can go here if needed
            }
        }

        // Initialize
        updateUI();
        window.addEventListener('resize', checkMobile);

    </script>
</body>
</html>