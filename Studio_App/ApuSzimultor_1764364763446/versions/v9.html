<!--
APP_NAME: ApuSzimul√°tor
APP_ICON: https://i.ibb.co/hxWpPsYp/59df509d962a.png
WINDOW_WIDTH: 380
WINDOW_HEIGHT: 650
STORE_ID: dad-sim-01
-->
<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ApuSzimul√°tor</title>
    <style>
        :root {
            --bg-color: #f3f3f3;
            --card-bg: #ffffff;
            --primary: #0078d4;
            --primary-hover: #006cc1;
            --text-main: #202020;
            --text-sub: #606060;
            --success: #107c10;
            --warning: #d83b01;
            --danger: #e81123;
            --radius: 12px;
            --shadow: 0 4px 14px rgba(0, 0, 0, 0.08);
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            user-select: none;
            color: var(--text-main);
        }

        /* Standard Desktop/Window Mode */
        #app-container {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            background: var(--card-bg);
            position: relative;
            overflow: hidden;
            transition: all 0.2s ease;
        }
        
        @media (min-width: 400px) and (min-height: 600px) {
            #app-container {
                border-radius: var(--radius); 
            }
        }

        /* --- Header --- */
        header {
            padding: 12px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #e5e5e5;
            background: #fff;
            z-index: 10;
            flex-shrink: 0;
            height: 54px;
        }

        .header-left {
            display: flex;
            flex-direction: column;
        }

        h1 {
            margin: 0;
            font-size: 1.1rem;
            font-weight: 600;
            line-height: 1.2;
        }

        .clock-display {
            font-size: 0.8rem;
            color: var(--text-sub);
            font-variant-numeric: tabular-nums;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .money-badge {
            background: #f0fdf4;
            color: #15803d;
            border: 1px solid #bbf7d0;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        /* --- Game Area --- */
        .game-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            padding: 15px;
            overflow-y: auto;
            background: linear-gradient(180deg, #fff 0%, #f8f9fa 100%);
            transition: background 1s ease;
        }
        
        .game-area.night-mode-bg {
            background: linear-gradient(180deg, #1a1a2e 0%, #16213e 100%);
        }

        /* --- Avatar --- */
        .avatar-container {
            position: relative;
            width: 120px;
            height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 0 20px 0;
            background: #eef4f9;
            border-radius: 50%;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.05), 0 10px 20px rgba(0,0,0,0.05);
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            flex-shrink: 0;
            z-index: 20;
        }

        .game-area.night-mode-bg .avatar-container {
            background: #2a2a40;
            box-shadow: 0 0 30px rgba(255, 255, 255, 0.1);
        }

        .avatar {
            font-size: 70px;
            line-height: 1;
            cursor: pointer;
            filter: drop-shadow(0 4px 4px rgba(0,0,0,0.1));
            transition: transform 0.2s;
            user-select: none;
        }
        
        .avatar:active {
            transform: scale(0.9) !important;
        }

        /* Animations */
        @keyframes chew {
            0% { transform: scale(1); }
            50% { transform: scale(1.1) rotate(5deg); }
            100% { transform: scale(1); }
        }
        
        @keyframes wobble {
            0%, 100% { transform: rotate(0deg) translateX(0); }
            25% { transform: rotate(5deg) translateX(5px); }
            75% { transform: rotate(-5deg) translateX(-5px); }
        }

        @keyframes sick-shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            10% { transform: translate(-1px, -2px) rotate(-1deg); }
            20% { transform: translate(-3px, 0px) rotate(1deg); }
            30% { transform: translate(3px, 2px) rotate(0deg); }
            40% { transform: translate(1px, -1px) rotate(1deg); }
            50% { transform: translate(-1px, 2px) rotate(-1deg); }
            60% { transform: translate(-3px, 1px) rotate(0deg); }
            70% { transform: translate(3px, 1px) rotate(-1deg); }
            80% { transform: translate(-1px, -1px) rotate(1deg); }
            90% { transform: translate(1px, 2px) rotate(0deg); }
            100% { transform: translate(1px, -2px) rotate(-1deg); }
        }
        
        @keyframes workout {
            0% { transform: translateY(0) scale(1,1); }
            50% { transform: translateY(5px) scale(1.1, 0.9); }
            100% { transform: translateY(0) scale(1,1); }
        }

        @keyframes dance {
            0% { transform: rotate(0deg) scale(1); }
            25% { transform: rotate(-10deg) scale(1.1); }
            50% { transform: rotate(10deg) scale(1.1); }
            75% { transform: rotate(-5deg) scale(1); }
            100% { transform: rotate(0deg) scale(1); }
        }

        .anim-chewing .avatar { animation: chew 0.3s infinite; }
        .anim-drunk .avatar { animation: wobble 2.5s infinite ease-in-out; }
        .anim-sick .avatar { animation: sick-shake 0.8s infinite; filter: hue-rotate(90deg); }
        .anim-sport .avatar { animation: workout 0.6s infinite; }
        .anim-dance .avatar { animation: dance 0.5s infinite; }

        /* Bubbles */
        .status-bubble {
            position: absolute;
            top: 5px;
            right: 5px;
            background: var(--danger);
            color: white;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            font-size: 14px;
            font-weight: bold;
            opacity: 0;
            transform: scale(0);
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            z-index: 5;
        }

        .status-bubble.visible {
            opacity: 1;
            transform: scale(1);
        }

        .thought-cloud {
            position: absolute;
            top: -20px;
            left: -20px;
            background: white;
            border: 2px solid #e5e5e5;
            padding: 6px 10px;
            border-radius: 16px;
            font-size: 1.4rem;
            opacity: 0;
            transform: scale(0) translateY(10px);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 10;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .thought-cloud.visible {
            opacity: 1;
            transform: scale(1) translateY(0);
        }

        .thought-cloud::after {
            content: '';
            position: absolute;
            bottom: -6px;
            right: 15px;
            width: 8px;
            height: 8px;
            background: white;
            border-bottom: 2px solid #e5e5e5;
            border-right: 2px solid #e5e5e5;
            transform: rotate(45deg);
        }

        /* --- Stats --- */
        .stats-container {
            width: 100%;
            max-width: 340px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            background: rgba(255,255,255,0.8);
            padding: 12px;
            border-radius: var(--radius);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(0,0,0,0.05);
            margin-bottom: 10px;
            flex-shrink: 0;
            transition: background 0.5s;
        }

        .game-area.night-mode-bg .stats-container {
            background: rgba(30,30,45,0.8);
            border-color: rgba(255,255,255,0.1);
            color: #fff;
        }

        .stat-row {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.9rem;
        }

        .stat-icon {
            font-size: 1.1rem;
            width: 24px;
            text-align: center;
        }

        .progress-bar-bg {
            flex: 1;
            height: 10px;
            background: #efefef;
            border-radius: 5px;
            overflow: hidden;
            box-shadow: inset 0 1px 2px rgba(0,0,0,0.05);
        }
        
        .game-area.night-mode-bg .progress-bar-bg {
            background: #333;
        }

        .progress-bar-fill {
            height: 100%;
            width: 100%;
            border-radius: 5px;
            transition: width 1s linear, background-color 0.3s; /* Smooth linear for tick updates */
        }
        
        .weight-display {
            font-size: 0.85rem;
            color: var(--text-sub);
            text-align: right;
            font-weight: 500;
        }

        .game-area.night-mode-bg .weight-display {
            color: #aaa;
        }

        /* --- Controls --- */
        .controls {
            padding: 16px;
            background: #fff;
            border-top: 1px solid #eee;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.02);
            overflow-y: auto;
            max-height: 40%;
            flex-shrink: 0;
        }

        button {
            border: none;
            background: #f8f8f8;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
            padding: 12px;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-main);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.2s;
            border: 1px solid transparent;
            min-height: 44px;
            position: relative;
        }

        button:hover {
            background: #fff;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.08);
            border-color: #eee;
        }

        button:active {
            transform: translateY(0);
            background: #f0f0f0;
        }

        button.primary {
            background: var(--primary);
            color: white;
            grid-column: span 2;
        }
        button.primary:hover {
            background: var(--primary-hover);
            color: white;
        }
        
        button.social {
            background: #605e5c;
            color: white;
            grid-column: span 2;
        }
        button.social:hover {
            background: #4d4b49;
            color: white;
        }

        .cost-label {
            font-size: 0.75em;
            opacity: 0.7;
            font-weight: normal;
            margin-left: 2px;
        }
        
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
            background: #f0f0f0 !important;
            color: #a0a0a0 !important;
            box-shadow: none !important;
            border-color: transparent !important;
        }
        
        button.locked-btn {
            background-color: #e6e6e6 !important;
            color: #888 !important;
            border: 1px dashed #ccc !important;
        }

        /* --- Overlays --- */
        .night-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 10, 28, 0.6);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            z-index: 100;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.8s;
            backdrop-filter: blur(2px);
        }

        body.sleeping .night-overlay {
            opacity: 1;
            pointer-events: auto;
            background: rgba(10, 10, 28, 0.85);
        }

        .zzz {
            font-size: 2.5rem;
            font-weight: bold;
            color: #8c9eff;
            animation: floatZ 2.5s infinite ease-in-out;
            position: absolute;
        }

        @keyframes floatZ {
            0% { transform: translate(0, 0) scale(1) rotate(-10deg); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translate(30px, -60px) scale(1.5) rotate(10deg); opacity: 0; }
        }

        .message-toast {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(20px);
            background: rgba(30, 30, 30, 0.95);
            color: white;
            padding: 8px 16px;
            border-radius: 30px;
            font-size: 0.85rem;
            pointer-events: none;
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            white-space: nowrap;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 50;
            text-align: center;
        }
        .message-toast.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        .sick-overlay {
            position: absolute;
            inset: 0;
            background: radial-gradient(circle, transparent 50%, rgba(100, 255, 0, 0.2));
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.5s;
            z-index: 40;
        }
        .sick-overlay.visible {
            opacity: 1;
        }

        /* --- Mobile / Responsiveness --- */
        body.mobile-mode #app-container,
        @media (max-width: 420px), (max-height: 650px) {
            header {
                padding: 1.5vh 3vw;
                height: auto;
                min-height: 48px;
            }
            header h1 {
                font-size: clamp(0.9rem, 4vw, 1.1rem);
            }
            .money-badge {
                padding: 0.5vh 2vw;
                font-size: clamp(0.75rem, 3.5vw, 0.9rem);
            }

            .game-area {
                padding: 1vh 3vw;
                justify-content: flex-start;
            }

            .avatar-container {
                width: clamp(70px, 18vh, 130px);
                height: clamp(70px, 18vh, 130px);
                margin: 1vh 0 2vh 0;
            }
            .avatar {
                font-size: clamp(40px, 10vh, 75px);
            }
            
            .stats-container {
                width: 100%;
                padding: 1.5vh 3vw;
                gap: 0.8vh;
            }
            .stat-row {
                font-size: clamp(0.75rem, 3.5vw, 0.9rem);
                gap: 2vw;
            }
            .stat-icon {
                font-size: clamp(0.9rem, 4vw, 1.1rem);
                width: clamp(16px, 5vw, 24px);
            }
            .progress-bar-bg {
                height: clamp(6px, 1.2vh, 10px);
            }
            .weight-display {
                font-size: clamp(0.7rem, 3vw, 0.85rem);
                margin-top: 0.5vh;
            }

            .controls {
                padding: 1.5vh 3vw;
                gap: 1vh;
            }
            
            button {
                min-height: clamp(36px, 6vh, 48px);
                padding: 0.5vh 1vw;
                font-size: clamp(0.75rem, 3.5vw, 0.9rem);
                gap: 1vw;
            }
            
            .cost-label {
                font-size: 0.8em;
            }
            
            .thought-cloud {
                font-size: clamp(1.1rem, 5vw, 1.4rem);
                padding: 0.5vh 2vw;
                top: -15%;
                left: -15%;
            }
        }

    </style>
</head>
<body class="">

    <div id="app-container">
        <header>
            <div class="header-left">
                <h1>ApuSzimul√°tor</h1>
                <div class="clock-display" id="clock-display">‚è∞ 08:00</div>
            </div>
            <div class="money-badge">
                <span>üí∞</span>
                <span id="money-display">2000 Ft</span>
            </div>
        </header>

        <div class="game-area" id="game-area">
            <div class="sick-overlay" id="sick-overlay"></div>
            
            <div class="avatar-container" id="avatar-container">
                <div class="thought-cloud" id="thought">üçï</div>
                <div class="status-bubble" id="alert-bubble">!</div>
                <div class="avatar" id="avatar">üë®</div>
            </div>

            <div class="stats-container">
                <!-- Health -->
                <div class="stat-row">
                    <span class="stat-icon" title="Eg√©szs√©g">‚ù§Ô∏è</span>
                    <div class="progress-bar-bg">
                        <div class="progress-bar-fill" id="fill-health" style="width: 100%; background: #d92b2b;"></div>
                    </div>
                </div>
                <!-- Hunger -->
                <div class="stat-row">
                    <span class="stat-icon" title="J√≥llakotts√°g">üçó</span>
                    <div class="progress-bar-bg">
                        <div class="progress-bar-fill" id="fill-hunger" style="width: 80%; background: #107c10;"></div>
                    </div>
                </div>
                <!-- Energy -->
                <div class="stat-row">
                    <span class="stat-icon" title="Energia">‚ö°</span>
                    <div class="progress-bar-bg">
                        <div class="progress-bar-fill" id="fill-energy" style="width: 60%; background: #ffb900;"></div>
                    </div>
                </div>
                <!-- Mood -->
                <div class="stat-row">
                    <span class="stat-icon" title="J√≥kedv">üòä</span>
                    <div class="progress-bar-bg">
                        <div class="progress-bar-fill" id="fill-mood" style="width: 90%; background: #0078d4;"></div>
                    </div>
                </div>
                
                <div class="weight-display">
                    Tests√∫ly: <span id="weight-display">80.0</span> kg ‚öñÔ∏è
                </div>
            </div>

            <div class="message-toast" id="toast">Hell√≥!</div>
        </div>

        <div class="controls">
            <button onclick="game.work()" id="btn-work" class="primary">
                <span>üíº</span> Munka <span class="cost-label">+1500</span>
            </button>
            
            <button onclick="game.meetFriends()" id="btn-friends" class="social">
                <span>üçª</span> Bar√°tok <span class="cost-label">-2k</span>
            </button>
            
            <button onclick="game.feed()" id="btn-feed">
                <span>üçî</span> Ev√©s <span class="cost-label">-500</span>
            </button>
            <button onclick="game.drink()" id="btn-drink">
                <span>üç∫</span> Iv√°s <span class="cost-label">-300</span>
            </button>
            
            <button onclick="game.sport()" id="btn-sport">
                <span>üèãÔ∏è</span> Edz√©s
            </button>
            <button onclick="game.tv()" id="btn-tv">
                <span>üì∫</span> T√©v√©
            </button>
            
            <button onclick="game.toggleSleep()" id="btn-sleep" style="grid-column: span 2;">
                <span>üò¥</span> Alv√°s
            </button>
        </div>

        <div class="night-overlay" onclick="game.wakeUp()">
            <div class="zzz" style="left: 45%; top: 50%; animation-delay: 0s">Z</div>
            <div class="zzz" style="left: 55%; top: 45%; animation-delay: 0.8s; font-size: 1.8rem">z</div>
            <div class="zzz" style="left: 50%; top: 40%; animation-delay: 1.6s; font-size: 1.2rem">z</div>
            <p style="margin-top: 140px; font-size: 0.9rem; color: #8c9eff; opacity: 0.8;">(Kattints az √©breszt√©shez)</p>
        </div>
    </div>

    <script>
        class DadGame {
            constructor() {
                // Initial Stats
                this.stats = {
                    hunger: 60,
                    energy: 70,
                    mood: 80,
                    health: 100,
                    weight: 82.0, // kg
                    money: 2000   // Ft
                };

                // Time system
                this.gameHour = 8;
                this.dayCount = 1;
                this.totalGameHours = 8; // Absolute time tracker
                this.tickCounter = 0;    // Tracks seconds for the 5s = 1h rule

                // State Flags
                this.isSleeping = false;
                this.isActionLocked = false;
                this.isSick = false;

                // Hidden Stats
                this.alcoholLevel = 0; // 0-100
                this.boredomCounter = 0; 
                this.lastAteTotalHours = -10; // Assuming he ate a while ago

                this.timer = null;

                // Message Banks
                this.msgs = {
                    eat: ["Hmm, ez finom!", "V√©gre kaja!", "Nyamm nyamm...", "Ez most j√≥l esett!", "M√°r korogtam!"],
                    eatFull: ["Huh, pukkad√°sig...", "Nem b√≠rom...", "T√∫l sok kaja...", "Jaj a hasam!"],
                    drink: ["Cs√∫szik!", "Hideg s√∂r, legjobb s√∂r!", "Eg√©szs√©gedre!", "M√©g egyet?"],
                    drinkDrunk: ["Hic... m√©g egyeet!", "Nem vagyok r√©szeg...", "Vil√°g forog...", "Woohoo!"],
                    work: ["D≈ël a l√©!", "Mel√≥ ezerrel...", "F≈ën√∂k ma ideges...", "Ut√°lom a h√©tf≈ëket.", "Kell a p√©nz."],
                    workTired: ["Majd elalszom...", "K√°v√© kell...", "T√∫l sok a t√∫l√≥ra...", "Nem b√≠rom m√°r."],
                    sport: ["Izoml√°z!", "No pain no gain!", "Ez f√°jt...", "Form√°ban vagyok!", "Fogyjon a h√°j!"],
                    tv: ["J√≥ ez a m≈±sor!", "Csak a foci!", "H√≠rad√≥... unalmas.", "Rekl√°m, rekl√°m..."],
                    friends: ["Nagy buli volt!", "R√©gen tal√°lkoztunk!", "Apu kir√∫g a h√°mb√≥l!", "J√≥ t√°rsas√°g!"]
                };

                // UI Elements
                this.ui = {
                    hunger: document.getElementById('fill-hunger'),
                    energy: document.getElementById('fill-energy'),
                    mood: document.getElementById('fill-mood'),
                    health: document.getElementById('fill-health'),
                    weight: document.getElementById('weight-display'),
                    money: document.getElementById('money-display'),
                    clock: document.getElementById('clock-display'),
                    gameArea: document.getElementById('game-area'),
                    
                    avatar: document.getElementById('avatar'),
                    avatarContainer: document.getElementById('avatar-container'),
                    alert: document.getElementById('alert-bubble'),
                    thought: document.getElementById('thought'),
                    toast: document.getElementById('toast'),
                    body: document.body,
                    sickOverlay: document.getElementById('sick-overlay'),
                    
                    btnFeed: document.getElementById('btn-feed'),
                    btnDrink: document.getElementById('btn-drink'),
                    btnTv: document.getElementById('btn-tv'),
                    btnWork: document.getElementById('btn-work'),
                    btnSport: document.getElementById('btn-sport'),
                    btnFriends: document.getElementById('btn-friends'),
                    btnSleep: document.getElementById('btn-sleep')
                };

                this.init();
            }

            init() {
                // Main Loop: Runs every 1 second (Real time)
                // Logic: 5 ticks = 1 game hour.
                this.timer = setInterval(() => this.tick(), 1000);
                this.updateUI();
                this.showToast("Szia! Vigy√°zz apura!");
                
                // Mobile check observer
                const observer = new MutationObserver(() => {
                    // CSS handles layout changes
                });
                observer.observe(document.body, { attributes: true, attributeFilter: ['class'] });
            }

            tick() {
                this.tickCounter++;

                // --- Hour Change Logic (Every 5 seconds) ---
                if (this.tickCounter >= 5) {
                    this.tickCounter = 0;
                    this.gameHour++;
                    this.totalGameHours++;
                    
                    if (this.gameHour >= 24) {
                        this.gameHour = 0;
                        this.dayCount++;
                        this.showToast(`${this.dayCount}. nap`);
                    }
                }

                this.processStats();
                this.updateUI();
            }

            processStats() {
                // Base decay rates per tick (1 second)
                // Calibration: 
                // 1 Game Hour = 5 Seconds.
                // Humans eat ~3 times a day.
                
                if (this.isSleeping) {
                    // SLEEP MECHANICS
                    this.stats.energy = Math.min(100, this.stats.energy + 2); // Regain energy
                    this.stats.health = Math.min(100, this.stats.health + 0.5); 
                    this.alcoholLevel = Math.max(0, this.alcoholLevel - 2); 
                    
                    // While sleeping, hunger drops very slowly
                    this.stats.hunger = Math.max(0, this.stats.hunger - 0.2);

                    // Auto wakeup
                    if (this.stats.energy >= 100 && this.gameHour >= 6 && this.gameHour <= 9) {
                        this.wakeUp();
                        this.showToast("J√≥ reggelt! Kipihentem magam.");
                    }
                } else {
                    // AWAKE MECHANICS
                    
                    // --- DIGESTION SYSTEM (REALISM) ---
                    // "Az √©tel 3 √≥r√°ig ev√©s ut√°n ne nagyon menjen, ut√°na kezdjen el lemenni"
                    let hoursSinceEat = this.totalGameHours - this.lastAteTotalHours;
                    let hungerDecay = 0;

                    if (hoursSinceEat < 3) {
                        // Digestion phase: Very slow decay
                        hungerDecay = 0.05; 
                    } else {
                        // Empty stomach phase: Faster decay
                        // Goal: Hunger 100 -> 0 in about 12 game hours (~60 seconds)
                        hungerDecay = 1.5; 
                    }
                    this.stats.hunger = Math.max(0, this.stats.hunger - hungerDecay);

                    // Energy decays constantly (~1 per tick means 100s to tire, roughly 20 game hours)
                    this.stats.energy = Math.max(0, this.stats.energy - 0.8);
                    
                    // Mood decays slowly
                    this.stats.mood = Math.max(0, this.stats.mood - 0.3);
                    
                    this.alcoholLevel = Math.max(0, this.alcoholLevel - 0.5);

                    // Health Logic
                    if (this.stats.weight > 115 || this.stats.weight < 60) this.stats.health -= 0.1;
                    if (this.stats.hunger < 10) this.stats.health -= 0.5;
                    if (this.stats.energy < 5) this.stats.health -= 0.2;

                    // Boredom
                    this.boredomCounter++;
                    if (this.boredomCounter > 20) this.stats.mood -= 0.5;

                    // Random events
                    if (Math.random() < 0.05) {
                         if (this.stats.hunger < 30) this.showThought("üçî");
                         else if (this.stats.energy < 30) this.showThought("üí§");
                    }
                }
                
                // Critical health check
                if (this.stats.health < 20 && !this.isSick) {
                    this.showThought("üè•");
                }
            }

            updateUI() {
                // Clock & Environment
                const displayHour = this.gameHour < 10 ? `0${this.gameHour}` : this.gameHour;
                // Simple minutes animation based on tickCounter (0-4) -> 00, 12, 24, 36, 48
                const displayMin = (this.tickCounter * 12).toString().padStart(2, '0');
                
                this.ui.clock.innerText = `‚è∞ ${displayHour}:${displayMin}`;
                
                // Night mode visual
                const isNight = (this.gameHour >= 21 || this.gameHour < 6);
                if (isNight) this.ui.gameArea.classList.add('night-mode-bg');
                else this.ui.gameArea.classList.remove('night-mode-bg');

                // Bars
                this.setBar(this.ui.hunger, this.stats.hunger, '#107c10', '#d83b01');
                this.setBar(this.ui.energy, this.stats.energy, '#ffb900', '#d83b01');
                this.setBar(this.ui.mood, this.stats.mood, '#0078d4', '#e81123');
                this.setBar(this.ui.health, this.stats.health, '#d92b2b', '#757575');

                // Text Stats
                this.ui.weight.innerText = this.stats.weight.toFixed(1);
                this.ui.money.innerText = `${this.stats.money} Ft`;

                // Avatar State Logic
                let face = 'üë®'; 
                let containerClass = '';
                
                // Weight visual modifier
                let scaleX = 1;
                if (this.stats.weight > 100) scaleX = 1.1;
                if (this.stats.weight > 120) scaleX = 1.25;
                if (this.stats.weight < 65) scaleX = 0.9;
                this.ui.avatar.style.transform = `scaleX(${scaleX})`;

                // Priority: Sleeping > Sick > Drunk > Critical Stats > Moods
                if (this.isSleeping) {
                    face = 'üò¥';
                } else if (this.isSick) {
                    face = 'ü§¢';
                    containerClass = 'anim-sick';
                } else if (this.alcoholLevel > 75) {
                    face = 'ü•¥'; 
                    containerClass = 'anim-drunk';
                } else if (this.stats.health < 30) {
                    face = 'ü§í'; // Sick/Injured
                } else if (this.stats.hunger < 15) {
                    face = 'üò´'; // Starving
                } else if (this.stats.energy < 15) {
                    face = 'üí§'; // Very tired
                } else if (this.alcoholLevel > 30) {
                    face = '‚ò∫Ô∏è'; // Tipsy
                } else if (this.stats.mood < 25) {
                    face = 'ü§¨'; // Angry/Sad
                } else if (this.stats.mood < 50) {
                    face = 'üòê'; // Bored/Neutral
                } else if (this.stats.mood > 90) {
                    face = 'ü§©'; // Ecstatic
                } else if (this.stats.mood > 75) {
                    face = 'üòé'; // Happy/Cool
                } else {
                    face = 'üôÇ'; // Normal
                }

                this.ui.avatar.innerText = face;
                
                if (!this.isActionLocked || this.isSick) {
                     this.ui.avatarContainer.className = 'avatar-container ' + containerClass;
                }

                this.ui.sickOverlay.classList.toggle('visible', this.isSick);

                // Alert Bubble
                const needsAttention = this.stats.hunger < 20 || this.stats.energy < 20 || this.stats.mood < 20 || this.stats.health < 40;
                this.ui.alert.classList.toggle('visible', needsAttention && !this.isSleeping);

                // --- Button States ---
                const globalDisable = this.isSleeping || this.isSick || this.isActionLocked;
                
                // Work Button Logic
                const workBtn = this.ui.btnWork;
                if (this.stats.energy < 15) {
                    workBtn.disabled = true;
                    workBtn.classList.add('locked-btn');
                    workBtn.innerHTML = `<span>üîí</span> T√∫l f√°radt!`;
                } else {
                    workBtn.disabled = globalDisable;
                    workBtn.classList.remove('locked-btn');
                    workBtn.innerHTML = `<span>üíº</span> Munka <span class="cost-label">+1500</span>`;
                }

                // Generic Disables
                const btns = [this.ui.btnFeed, this.ui.btnDrink, this.ui.btnTv, this.ui.btnSport, this.ui.btnFriends];
                btns.forEach(btn => btn.disabled = globalDisable);

                // Cost checks
                if (!globalDisable) {
                    if (this.stats.money < 2000) this.ui.btnFriends.disabled = true;
                    if (this.stats.money < 500) this.ui.btnFeed.disabled = true;
                    if (this.stats.money < 300) this.ui.btnDrink.disabled = true;
                }
            }

            setBar(element, value, goodColor, badColor) {
                element.style.width = `${Math.max(0, Math.min(100, value))}%`;
                // Color transition logic
                element.style.backgroundColor = value < 30 ? badColor : goodColor;
            }

            getRandomMsg(key) {
                const arr = this.msgs[key];
                if (!arr) return "";
                return arr[Math.floor(Math.random() * arr.length)];
            }

            resetInteraction() {
                this.boredomCounter = 0;
            }

            // --- Actions ---
            work() {
                if (this.isActionLocked) return;
                
                this.resetInteraction();
                this.animateAction('anim-chewing'); // Using chew anim for general "doing something"
                
                this.stats.money += 1500;
                this.stats.energy = Math.max(0, this.stats.energy - 30);
                this.stats.mood = Math.max(0, this.stats.mood - 15);
                this.stats.hunger = Math.max(0, this.stats.hunger - 15);
                
                // Work takes time (Realism)
                // Advancing time by 2 hours (approx 10 ticks) in terms of stats impact
                // but purely visual skip for now to keep game flow
                
                if (this.stats.energy < 20) {
                    this.showToast(this.getRandomMsg('workTired'));
                    this.showThought("üò´");
                } else {
                    this.showToast(this.getRandomMsg('work'));
                    this.showThought("üí∏");
                }
            }

            meetFriends() {
                if (this.isActionLocked) return;
                
                this.stats.money -= 2000;
                this.resetInteraction();
                this.animateAction('anim-dance');

                this.stats.mood = Math.min(100, this.stats.mood + 60);
                this.stats.hunger = Math.max(0, this.stats.hunger - 10);
                this.stats.energy = Math.max(0, this.stats.energy - 30);
                this.alcoholLevel += 50;

                if (this.alcoholLevel >= 100) {
                    setTimeout(() => this.vomit(), 1000);
                } else {
                    this.showToast(this.getRandomMsg('friends'));
                    this.showThought("üçª");
                }
            }

            sport() {
                if (this.isActionLocked) return;
                this.resetInteraction();
                this.animateAction('anim-sport');

                this.stats.weight = Math.max(55, this.stats.weight - 0.6);
                this.stats.health = Math.min(100, this.stats.health + 5);
                this.stats.energy = Math.max(0, this.stats.energy - 25);
                this.stats.hunger = Math.max(0, this.stats.hunger - 20);
                this.stats.mood = Math.min(100, this.stats.mood + 10);

                this.showToast(this.getRandomMsg('sport'));
                this.showThought("üí™");
            }

            feed() {
                if (this.isActionLocked) return;
                
                this.stats.money -= 500;
                this.resetInteraction();
                this.animateAction('anim-chewing');
                
                this.alcoholLevel = Math.max(0, this.alcoholLevel - 15);
                this.stats.weight += 0.5;
                
                // Record eating time for digestion logic
                this.lastAteTotalHours = this.totalGameHours;

                // Contextual logic
                if (this.stats.hunger > 90) {
                    this.showToast(this.getRandomMsg('eatFull'));
                    this.stats.health -= 2; // Overeating hurts
                    this.stats.energy -= 10; // Food coma
                } else {
                    this.showToast(this.getRandomMsg('eat'));
                    this.stats.energy = Math.min(100, this.stats.energy + 5);
                }

                this.stats.hunger = Math.min(100, this.stats.hunger + 40);
                this.stats.mood = Math.min(100, this.stats.mood + 8);
                this.showThought("üçó");
            }

            drink() {
                if (this.isActionLocked) return;

                this.stats.money -= 300;
                this.resetInteraction();
                this.alcoholLevel += 30; 
                this.stats.weight += 0.2;
                
                if (this.alcoholLevel >= 100) {
                    this.vomit();
                    return;
                }

                this.animateAction('anim-chewing');
                
                this.stats.hunger = Math.min(100, this.stats.hunger + 5);
                this.stats.mood = Math.min(100, this.stats.mood + 15);
                this.stats.energy -= 5;
                this.stats.health -= 2;

                if (this.alcoholLevel > 50) {
                    this.showToast(this.getRandomMsg('drinkDrunk'));
                } else {
                    this.showToast(this.getRandomMsg('drink'));
                }
            }

            vomit() {
                this.isSick = true;
                this.isActionLocked = true;
                
                this.stats.hunger = 10;
                this.stats.energy = Math.max(0, this.stats.energy - 40);
                this.stats.mood = Math.max(0, this.stats.mood - 50);
                this.stats.health = Math.max(0, this.stats.health - 15);
                this.alcoholLevel = 0;
                
                this.showToast("Jaj ne! T√∫l sok volt!");
                this.showThought("ü§Æ");
                this.updateUI();

                setTimeout(() => {
                    this.isSick = false;
                    this.isActionLocked = false;
                    this.showToast("Uh... soha t√∂bbet...");
                    this.updateUI();
                }, 4000);
            }

            tv() {
                if (this.isActionLocked) return;
                this.resetInteraction();
                this.stats.mood = Math.min(100, this.stats.mood + 15);
                this.stats.energy -= 5;
                this.showToast(this.getRandomMsg('tv'));
                this.showThought("üì∫");
            }

            toggleSleep() {
                if (this.isSick) return;
                if (this.isSleeping) this.wakeUp();
                else this.sleep();
            }

            sleep() {
                this.resetInteraction();
                this.isSleeping = true;
                this.ui.body.classList.add('sleeping');
                this.ui.btnSleep.innerHTML = "<span>‚òÄÔ∏è</span> √âbreszt√©s";
                this.showToast("J√≥ √©jszak√°t!");
                this.updateUI();
            }

            wakeUp() {
                this.isSleeping = false;
                this.ui.body.classList.remove('sleeping');
                this.ui.btnSleep.innerHTML = "<span>üò¥</span> Alv√°s";
                this.showToast("J√≥ reggelt!");
                this.updateUI();
            }

            // --- Helpers ---
            animateAction(className) {
                if (this.alcoholLevel > 70) return; // Too drunk to animate properly
                this.ui.avatarContainer.classList.add(className);
                setTimeout(() => {
                    this.ui.avatarContainer.classList.remove(className);
                    this.updateUI(); 
                }, 800);
            }

            showToast(msg) {
                // Clear existing timeout if spamming buttons
                if (this.toastTimer) clearTimeout(this.toastTimer);
                
                this.ui.toast.innerText = msg;
                this.ui.toast.classList.add('show');
                this.toastTimer = setTimeout(() => {
                    this.ui.toast.classList.remove('show');
                }, 2000);
            }

            showThought(emoji) {
                if(emoji) {
                     this.ui.thought.innerText = emoji;
                } else {
                    const randoms = ["üöó", "üîß", "üé∏", "üç∫", "‚öΩ", "üèñÔ∏è"];
                    this.ui.thought.innerText = randoms[Math.floor(Math.random() * randoms.length)];
                }
                
                this.ui.thought.classList.add('visible');
                setTimeout(() => {
                    this.ui.thought.classList.remove('visible');
                }, 2000);
            }
        }

        window.addEventListener('DOMContentLoaded', () => {
            window.game = new DadGame();
        });
    </script>
</body>
</html>