<!--
APP_NAME: Gemini Workspace
APP_DESCRIPTION: A modern web-based operating system interface with functional mini-apps.
APP_ICON: 
APP_CATEGORY: Productivity
WINDOW_WIDTH: 420
WINDOW_HEIGHT: 750
VERSION_SUMMARY: Initial launch with functional Notes and Paint apps.
STORE_ID: gemini-workspace-os
-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Gemini Workspace</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap');

        :root {
            --os-bg: #232a4e;
            --drawer-bg: rgba(255, 255, 255, 0.06);
            --drawer-border: rgba(255, 255, 255, 0.1);
            --text-light: #ffffff;
            --text-dark: #333333;
            --window-bg: #f8fafc;
            --primary: #3b82f6;
            --radius-md: 12px;
            --radius-lg: 24px;
            --shadow-soft: 0 8px 32px rgba(0, 0, 0, 0.15);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            user-select: none;
            -webkit-user-drag: none;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--os-bg);
            background-image: radial-gradient(circle at 50% -20%, #3a4785 0%, #232a4e 60%);
            color: var(--text-light);
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* --- Status Bar --- */
        #status-bar {
            height: 36px;
            padding: 0 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 13px;
            font-weight: 500;
            z-index: 10;
        }

        .status-icons {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .status-icons svg {
            width: 16px;
            height: 16px;
            fill: #cbd5e1;
        }
        
        .status-icons .colored-icon {
            fill: none;
        }

        /* --- Desktop & App Drawer --- */
        #desktop {
            flex: 1;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }

        .app-drawer {
            width: 100%;
            max-width: 600px;
            flex: 1;
            background: var(--drawer-bg);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid var(--drawer-border);
            border-radius: var(--radius-lg);
            padding: 32px 20px;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-auto-rows: min-content;
            gap: 24px 12px;
            box-shadow: inset 0 1px 0 rgba(255,255,255,0.1);
        }

        body.mobile-mode .app-drawer {
            grid-template-columns: repeat(3, 1fr);
            padding: 24px 12px;
        }

        /* --- App Icons --- */
        .app-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .app-item:active {
            transform: scale(0.9);
        }

        .app-icon-container {
            width: 56px;
            height: 56px;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        .app-icon-container svg {
            width: 100%;
            height: 100%;
            filter: drop-shadow(0 4px 6px rgba(0,0,0,0.2));
        }

        .app-label {
            font-size: 12px;
            font-weight: 500;
            text-align: center;
            text-shadow: 0 1px 2px rgba(0,0,0,0.5);
            line-height: 1.2;
        }

        /* --- Window System (Apps) --- */
        #window-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 100;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .os-window {
            width: 100%;
            max-width: 400px;
            height: 85%;
            background: var(--window-bg);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-soft);
            display: flex;
            flex-direction: column;
            pointer-events: auto;
            transform: scale(0.95);
            opacity: 0;
            transition: all 0.25s cubic-bezier(0.16, 1, 0.3, 1);
            overflow: hidden;
            position: absolute;
        }

        .os-window.active {
            transform: scale(1);
            opacity: 1;
        }

        body.mobile-mode .os-window {
            height: 100%;
            max-width: 100%;
            border-radius: 0;
            padding: 0;
        }

        .window-header {
            height: 44px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(8px);
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 16px;
            color: var(--text-dark);
        }

        .window-title {
            font-weight: 600;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .window-title svg {
            width: 18px;
            height: 18px;
        }

        .btn-close {
            background: #e2e8f0;
            border: none;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #64748b;
            font-size: 18px;
            transition: background 0.2s;
        }

        .btn-close:hover {
            background: #cbd5e1;
            color: #0f172a;
        }

        .window-content {
            flex: 1;
            overflow-y: auto;
            position: relative;
            color: var(--text-dark);
            background: var(--window-bg);
        }

        /* --- Mini App Specific Styles --- */
        .app-notes textarea {
            width: 100%;
            height: 100%;
            border: none;
            resize: none;
            padding: 16px;
            font-family: 'Inter', sans-serif;
            font-size: 15px;
            background: transparent;
            outline: none;
            line-height: 1.6;
        }

        .app-paint {
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        .paint-toolbar {
            padding: 12px;
            background: #fff;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            gap: 12px;
            align-items: center;
        }
        .color-btn {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: 2px solid transparent;
            cursor: pointer;
            transition: transform 0.1s;
        }
        .color-btn:active { transform: scale(0.8); }
        .color-btn.selected { border-color: #333; }
        .action-btn {
            margin-left: auto;
            padding: 6px 12px;
            border-radius: 6px;
            border: 1px solid #cbd5e1;
            background: #fff;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
        }
        .action-btn:active { background: #f1f5f9; }
        #paint-canvas {
            flex: 1;
            background: #ffffff;
            cursor: crosshair;
            touch-action: none; /* Prevent scrolling while drawing */
        }

        .app-generic {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            padding: 32px;
            text-align: center;
            color: #64748b;
        }
        .app-generic svg {
            width: 64px;
            height: 64px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

    </style>
</head>
<body>

    <header id="status-bar">
        <div id="clock">08:38 PM</div>
        <div class="status-icons">
            <!-- Signal Bars -->
            <svg class="colored-icon" viewBox="0 0 24 24" width="24" height="24">
                <rect x="2" y="16" width="4" height="6" fill="#f59e0b" rx="1"/>
                <rect x="8" y="11" width="4" height="11" fill="#f59e0b" rx="1"/>
                <rect x="14" y="6" width="4" height="16" fill="#f59e0b" rx="1"/>
                <rect x="20" y="2" width="4" height="20" fill="#475569" rx="1"/>
            </svg>
            <!-- Battery -->
            <svg class="colored-icon" viewBox="0 0 24 24" width="24" height="24">
                <rect x="2" y="6" width="18" height="12" fill="#22c55e" rx="2"/>
                <path d="M22 10v4a1 1 0 001-1v-2a1 1 0 00-1-1z" fill="#94a3b8"/>
                <path d="M9 10l-2 4h3l-1 3 3-5H9l1-2z" fill="#fff"/>
            </svg>
            <!-- Bell -->
            <svg class="colored-icon" viewBox="0 0 24 24" width="24" height="24">
                <path d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.9 2 2 2zm6-6v-5c0-3.07-1.63-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.64 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2zm-2 1H8v-6c0-2.48 1.51-4.5 4-4.5s4 2.02 4 4.5v6z" fill="#fbbf24"/>
            </svg>
        </div>
    </header>

    <main id="desktop">
        <div class="app-drawer" id="app-grid">
            <!-- Dynamically populated -->
        </div>
    </main>

    <div id="window-container">
        <!-- Windows injected here -->
    </div>

    <script>
        // --- Audio System ---
        let audioCtx;
        function initAudio() {
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
            if (audioCtx.state === 'suspended') {
                audioCtx.resume();
            }
        }

        function playSound(type) {
            if (!audioCtx) return;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);

            const now = audioCtx.currentTime;
            
            if (type === 'click') {
                osc.type = 'sine';
                osc.frequency.setValueAtTime(600, now);
                osc.frequency.exponentialRampToValueAtTime(1000, now + 0.05);
                gain.gain.setValueAtTime(0.1, now);
                gain.gain.exponentialRampToValueAtTime(0.001, now + 0.1);
                osc.start(now);
                osc.stop(now + 0.1);
            } else if (type === 'open') {
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(300, now);
                osc.frequency.exponentialRampToValueAtTime(600, now + 0.15);
                gain.gain.setValueAtTime(0.05, now);
                gain.gain.linearRampToValueAtTime(0, now + 0.2);
                osc.start(now);
                osc.stop(now + 0.2);
            } else if (type === 'close') {
                osc.type = 'sine';
                osc.frequency.setValueAtTime(400, now);
                osc.frequency.exponentialRampToValueAtTime(200, now + 0.1);
                gain.gain.setValueAtTime(0.05, now);
                gain.gain.linearRampToValueAtTime(0, now + 0.15);
                osc.start(now);
                osc.stop(now + 0.15);
            }
        }

        // --- Clock Update ---
        function updateClock() {
            const now = new Date();
            let hours = now.getHours();
            let minutes = now.getMinutes();
            const ampm = hours >= 12 ? 'PM' : 'AM';
            hours = hours % 12;
            hours = hours ? hours : 12; 
            minutes = minutes < 10 ? '0' + minutes : minutes;
            document.getElementById('clock').textContent = `${hours}:${minutes} ${ampm}`;
        }
        setInterval(updateClock, 1000);
        updateClock();

        // --- App Data & SVGs ---
        const apps = [
            {
                id: 'gemtop',
                name: 'My Gemtop',
                icon: `<svg viewBox="0 0 48 48">
                        <rect x="4" y="8" width="40" height="26" rx="3" fill="#38bdf8"/>
                        <rect x="6" y="10" width="36" height="20" rx="1" fill="#0284c7"/>
                        <path d="M20 34h8v4h-8z" fill="#94a3b8"/>
                        <rect x="16" y="38" width="16" height="3" rx="1.5" fill="#94a3b8"/>
                       </svg>`,
                render: renderGeneric('System Info', 'Gemini OS v11.0<br>Memory: 4GB<br>Storage: 64GB')
            },
            {
                id: 'storyteller',
                name: 'Storyteller',
                icon: `<svg viewBox="0 0 48 48">
                        <rect x="10" y="12" width="12" height="28" rx="2" fill="#3b82f6" transform="rotate(-10 16 26)"/>
                        <rect x="18" y="10" width="12" height="28" rx="2" fill="#06b6d4"/>
                        <rect x="28" y="12" width="12" height="28" rx="2" fill="#a855f7" transform="rotate(5 34 26)"/>
                        <rect x="22" y="12" width="4" height="24" fill="#67e8f9" opacity="0.5"/>
                       </svg>`,
                render: renderGeneric('Storyteller', 'Your library is currently empty.<br>Visit the store to download books.')
            },
            {
                id: 'gemnotes',
                name: 'GemNotes',
                icon: `<svg viewBox="0 0 48 48">
                        <rect x="12" y="6" width="28" height="36" rx="3" fill="#38bdf8"/>
                        <rect x="12" y="6" width="6" height="36" fill="#0284c7"/>
                        <!-- Bindings -->
                        <circle cx="15" cy="12" r="2" fill="#fff"/><rect x="8" y="11" width="8" height="2" fill="#fff" rx="1"/>
                        <circle cx="15" cy="20" r="2" fill="#fff"/><rect x="8" y="19" width="8" height="2" fill="#fff" rx="1"/>
                        <circle cx="15" cy="28" r="2" fill="#fff"/><rect x="8" y="27" width="8" height="2" fill="#fff" rx="1"/>
                        <circle cx="15" cy="36" r="2" fill="#fff"/><rect x="8" y="35" width="8" height="2" fill="#fff" rx="1"/>
                        <!-- Lines -->
                        <rect x="22" y="14" width="14" height="2" fill="#fff" opacity="0.7"/>
                        <rect x="22" y="22" width="14" height="2" fill="#fff" opacity="0.7"/>
                        <rect x="22" y="30" width="10" height="2" fill="#fff" opacity="0.7"/>
                       </svg>`,
                render: renderNotes
            },
            {
                id: 'gempaint',
                name: 'GemPaint',
                icon: `<svg viewBox="0 0 48 48">
                        <path d="M24 6C14 6 6 14 6 24c0 10 9 18 19 18 3 0 5-2 5-5 0-1.5-.5-2.8-1.5-3.8-.8-.8-1.5-1.9-1.5-3.2 0-2.8 2.2-5 5-5h1.5C40.5 25 44 20.5 44 15 44 10 35 6 24 6z" fill="#38bdf8"/>
                        <circle cx="14" cy="24" r="3" fill="#ef4444"/>
                        <circle cx="18" cy="14" r="3" fill="#eab308"/>
                        <circle cx="28" cy="12" r="3" fill="#22c55e"/>
                        <circle cx="36" cy="18" r="3" fill="#3b82f6"/>
                       </svg>`,
                render: renderPaint
            },
            {
                id: 'studio',
                name: 'Gemini\nStudio',
                icon: `<svg viewBox="0 0 48 48">
                        <path d="M18 14l-10 10 10 10" fill="none" stroke="#38bdf8" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M30 14l10 10-10 10" fill="none" stroke="#38bdf8" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M28 10l-8 28" fill="none" stroke="#0284c7" stroke-width="5" stroke-linecap="round"/>
                       </svg>`,
                render: renderGeneric('Studio', 'Developer tools are not installed.<br>Ready for code generation.')
            },
            {
                id: 'sweeper',
                name: 'GemSweeper',
                icon: `<svg viewBox="0 0 48 48">
                        <circle cx="24" cy="24" r="14" fill="#64748b"/>
                        <circle cx="20" cy="20" r="4" fill="#94a3b8" opacity="0.5"/>
                        <!-- Spikes -->
                        <rect x="22" y="6" width="4" height="6" rx="1" fill="#64748b"/>
                        <rect x="22" y="36" width="4" height="6" rx="1" fill="#64748b"/>
                        <rect x="6" y="22" width="6" height="4" rx="1" fill="#64748b"/>
                        <rect x="36" y="22" width="6" height="4" rx="1" fill="#64748b"/>
                        <rect x="10" y="10" width="4" height="6" rx="1" fill="#64748b" transform="rotate(-45 12 13)"/>
                        <rect x="34" y="32" width="4" height="6" rx="1" fill="#64748b" transform="rotate(-45 36 35)"/>
                        <rect x="32" y="10" width="6" height="4" rx="1" fill="#64748b" transform="rotate(-45 35 12)"/>
                        <rect x="10" y="34" width="6" height="4" rx="1" fill="#64748b" transform="rotate(-45 13 36)"/>
                       </svg>`,
                render: renderGeneric('GemSweeper', 'Boom! Just kidding.<br>Full game coming in next update.')
            },
            {
                id: 'settings',
                name: 'Settings',
                icon: `<svg viewBox="0 0 48 48">
                        <path d="M42.3 26.8l-4.6-1.5c-.3-1-.8-1.9-1.3-2.7l2.4-4.2c.4-.7.2-1.6-.4-2.1l-3.5-3.5c-.6-.6-1.5-.7-2.1-.4l-4.2 2.4c-.8-.6-1.7-1-2.7-1.3l-1.5-4.6c-.2-.8-1-1.4-1.8-1.4h-5c-.8 0-1.6.6-1.8 1.4l-1.5 4.6c-1 .3-1.9.8-2.7 1.3l-4.2-2.4c-.7-.4-1.6-.2-2.1.4l-3.5 3.5c-.6.6-.7 1.5-.4 2.1l2.4 4.2c-.6.8-1 1.7-1.3 2.7l-4.6 1.5c-.8.2-1.4 1-1.4 1.8v5c0 .8.6 1.6 1.4 1.8l4.6 1.5c.3 1 .8 1.9 1.3 2.7l-2.4 4.2c-.4.7-.2 1.6.4 2.1l3.5 3.5c.6.6 1.5.7 2.1.4l4.2-2.4c.8.6 1.7 1 2.7 1.3l1.5 4.6c.2.8 1 1.4 1.8 1.4h5c.8 0 1.6-.6 1.8-1.4l1.5-4.6c1-.3 1.9-.8 2.7-1.3l4.2 2.4c.7.4 1.6.2 2.1-.4l3.5-3.5c.6-.6.7-1.5.4-2.1l-2.4-4.2c.6-.8 1-1.7 1.3-2.7l4.6-1.5c.8-.2 1.4-1 1.4-1.8v-5c0-.8-.6-1.6-1.4-1.8zM24 32c-4.4 0-8-3.6-8-8s3.6-8 8-8 8 3.6 8 8-3.6 8-8 8z" fill="#94a3b8"/>
                       </svg>`,
                render: renderSettings
            },
            {
                id: 'quizmania',
                name: 'QuizMania',
                icon: `<svg viewBox="0 0 48 48">
                        <path d="M10 12h18v14H14l-4 4v-4h-2a2 2 0 01-2-2V14a2 2 0 012-2z" fill="#38bdf8"/>
                        <path d="M20 22h18v14h-2v4l-4-4H20a2 2 0 01-2-2V24a2 2 0 012-2z" fill="#0284c7"/>
                        <text x="19" y="22" fill="#fff" font-family="sans-serif" font-weight="bold" font-size="10" text-anchor="middle">Q</text>
                        <text x="29" y="32" fill="#fff" font-family="sans-serif" font-weight="bold" font-size="10" text-anchor="middle">A</text>
                       </svg>`,
                render: renderGeneric('QuizMania', 'Ready to test your knowledge?<br>Feature unlocked at Level 5.')
            }
        ];

        // --- Core UI Initialization ---
        const drawer = document.getElementById('app-grid');
        const windowContainer = document.getElementById('window-container');
        let activeWindow = null;

        apps.forEach(app => {
            const el = document.createElement('div');
            el.className = 'app-item';
            // Convert newline in name to <br> for styling
            const displayName = app.name.replace('\n', '<br>');
            el.innerHTML = `
                <div class="app-icon-container">
                    ${app.icon}
                </div>
                <div class="app-label">${displayName}</div>
            `;
            el.addEventListener('click', () => openApp(app));
            // Touch handling for init audio context on iOS/mobile
            el.addEventListener('touchstart', initAudio, {passive: true});
            drawer.appendChild(el);
        });

        // Click anywhere on body to init audio
        document.body.addEventListener('click', initAudio, {once: true});

        function openApp(app) {
            initAudio();
            playSound('click');
            setTimeout(() => playSound('open'), 100);

            if (activeWindow) {
                closeApp(activeWindow);
            }

            const win = document.createElement('div');
            win.className = 'os-window';
            win.innerHTML = `
                <header class="window-header">
                    <span class="window-title">
                        <div style="width:18px;height:18px;display:flex;align-items:center;">${app.icon}</div>
                        ${app.name.replace('\n', ' ')}
                    </span>
                    <button class="btn-close">Ã—</button>
                </header>
                <div class="window-content" id="content-${app.id}"></div>
            `;

            windowContainer.appendChild(win);
            
            const closeBtn = win.querySelector('.btn-close');
            closeBtn.addEventListener('click', () => {
                playSound('close');
                closeApp(win);
            });

            const contentArea = win.querySelector('.window-content');
            app.render(contentArea);

            // Trigger animation
            requestAnimationFrame(() => {
                win.classList.add('active');
            });
            activeWindow = win;
        }

        function closeApp(winElement) {
            winElement.classList.remove('active');
            setTimeout(() => {
                if(winElement.parentNode) {
                    winElement.parentNode.removeChild(winElement);
                }
                if(activeWindow === winElement) activeWindow = null;
            }, 250); // match transition time
        }

        // --- App Render Functions ---

        function renderGeneric(title, message) {
            return function(container) {
                container.innerHTML = `
                    <div class="app-generic">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="10"></circle>
                            <line x1="12" y1="8" x2="12" y2="12"></line>
                            <line x1="12" y1="16" x2="12.01" y2="16"></line>
                        </svg>
                        <h3 style="margin-bottom:8px; color:#0f172a;">${title}</h3>
                        <p style="font-size:14px; line-height:1.5;">${message}</p>
                    </div>
                `;
            }
        }

        function renderNotes(container) {
            container.innerHTML = `
                <div class="app-notes" style="height:100%;">
                    <textarea id="gemnotes-text" placeholder="Start typing..."></textarea>
                </div>
            `;
            const ta = container.querySelector('#gemnotes-text');
            ta.value = localStorage.getItem('gemnotes_data') || '';
            ta.addEventListener('input', (e) => {
                localStorage.setItem('gemnotes_data', e.target.value);
            });
        }

        function renderSettings(container) {
            container.innerHTML = `
                <div style="padding: 20px;">
                    <h3 style="margin-bottom:20px;">Preferences</h3>
                    
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:16px; padding-bottom:16px; border-bottom:1px solid #e2e8f0;">
                        <span>System Sounds</span>
                        <label style="position:relative; display:inline-block; width:44px; height:24px;">
                            <input type="checkbox" id="toggle-sound" checked style="opacity:0; width:0; height:0;">
                            <span style="position:absolute; cursor:pointer; top:0; left:0; right:0; bottom:0; background-color:#3b82f6; border-radius:24px; transition:.4s;">
                                <span style="position:absolute; content:''; height:18px; width:18px; left:3px; bottom:3px; background-color:white; border-radius:50%; transition:.4s; transform:translateX(20px);"></span>
                            </span>
                        </label>
                    </div>

                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:16px; padding-bottom:16px; border-bottom:1px solid #e2e8f0;">
                        <span>Dark Mode</span>
                        <label style="position:relative; display:inline-block; width:44px; height:24px;">
                            <input type="checkbox" checked disabled style="opacity:0; width:0; height:0;">
                            <span style="position:absolute; cursor:not-allowed; top:0; left:0; right:0; bottom:0; background-color:#3b82f6; opacity:0.5; border-radius:24px;">
                                <span style="position:absolute; height:18px; width:18px; left:3px; bottom:3px; background-color:white; border-radius:50%; transform:translateX(20px);"></span>
                            </span>
                        </label>
                    </div>
                    <p style="font-size:12px; color:#94a3b8;">Dark mode is enforced by OS policy.</p>
                </div>
            `;

            const soundToggle = container.querySelector('#toggle-sound');
            // Fake toggle visual
            soundToggle.addEventListener('change', (e) => {
                const slider = e.target.nextElementSibling;
                const dot = slider.firstElementChild;
                if(e.target.checked) {
                    slider.style.backgroundColor = '#3b82f6';
                    dot.style.transform = 'translateX(20px)';
                    // Re-enable sound logic if we had a global mute state
                } else {
                    slider.style.backgroundColor = '#ccc';
                    dot.style.transform = 'translateX(0)';
                }
            });
        }

        function renderPaint(container) {
            container.innerHTML = `
                <div class="app-paint">
                    <div class="paint-toolbar">
                        <button class="color-btn selected" style="background:#0f172a" data-color="#0f172a"></button>
                        <button class="color-btn" style="background:#ef4444" data-color="#ef4444"></button>
                        <button class="color-btn" style="background:#3b82f6" data-color="#3b82f6"></button>
                        <button class="color-btn" style="background:#22c55e" data-color="#22c55e"></button>
                        <button class="action-btn" id="paint-clear">Clear</button>
                    </div>
                    <canvas id="paint-canvas"></canvas>
                </div>
            `;

            const canvas = container.querySelector('#paint-canvas');
            const ctx = canvas.getContext('2d');
            const toolbar = container.querySelector('.paint-toolbar');
            let isDrawing = false;
            let currentColor = '#0f172a';

            // Resize canvas to fit remaining space
            function resizeCanvas() {
                canvas.width = canvas.parentElement.clientWidth;
                canvas.height = canvas.parentElement.clientHeight - toolbar.clientHeight;
                ctx.lineCap = 'round';
                ctx.lineJoin = 'round';
                ctx.lineWidth = 4;
            }
            
            // Need a slight delay for DOM to render sizes
            setTimeout(resizeCanvas, 10);
            window.addEventListener('resize', resizeCanvas);

            function getPos(e) {
                const rect = canvas.getBoundingClientRect();
                const clientX = e.touches ? e.touches[0].clientX : e.clientX;
                const clientY = e.touches ? e.touches[0].clientY : e.clientY;
                return {
                    x: clientX - rect.left,
                    y: clientY - rect.top
                };
            }

            function startDraw(e) {
                isDrawing = true;
                const pos = getPos(e);
                ctx.beginPath();
                ctx.moveTo(pos.x, pos.y);
                e.preventDefault();
            }

            function draw(e) {
                if (!isDrawing) return;
                const pos = getPos(e);
                ctx.strokeStyle = currentColor;
                ctx.lineTo(pos.x, pos.y);
                ctx.stroke();
                e.preventDefault();
            }

            function stopDraw() {
                isDrawing = false;
                ctx.closePath();
            }

            canvas.addEventListener('mousedown', startDraw);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDraw);
            canvas.addEventListener('mouseout', stopDraw);

            canvas.addEventListener('touchstart', startDraw, {passive: false});
            canvas.addEventListener('touchmove', draw, {passive: false});
            canvas.addEventListener('touchend', stopDraw);

            // Toolbar logic
            const colorBtns = container.querySelectorAll('.color-btn');
            colorBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    colorBtns.forEach(b => b.classList.remove('selected'));
                    btn.classList.add('selected');
                    currentColor = btn.dataset.color;
                });
            });

            container.querySelector('#paint-clear').addEventListener('click', () => {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
            });
        }

    </script>
</body>
</html>