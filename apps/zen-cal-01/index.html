<!--
APP_NAME: Zen Calendar
APP_DESCRIPTION: A modern, sleek calendar to track dates and simple daily notes.
APP_ICON: https://i.ibb.co/DD66fVgt/413773c33938.png
WINDOW_WIDTH: 380
WINDOW_HEIGHT: 540
STORE_ID: zen-cal-01
-->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Zen Calendar</title>
<style>
    :root {
        --bg-color: #f3f3f3;
        --card-bg: #ffffff;
        --text-primary: #202020;
        --text-secondary: #666666;
        --accent: #0078d4;
        --accent-hover: #106ebe;
        --accent-light: #e0efff;
        --border-radius: 12px;
        --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        --today-dot: #ff5722;
    }

    * {
        box-sizing: border-box;
        user-select: none;
        -webkit-user-select: none;
        cursor: default;
    }

    body {
        margin: 0;
        padding: 0;
        font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
        background-color: var(--bg-color);
        color: var(--text-primary);
        height: 100vh;
        overflow: hidden;
        display: flex;
        flex-direction: column;
    }

    /* Main Container */
    #app {
        display: flex;
        flex-direction: column;
        height: 100%;
        padding: 16px;
    }

    /* Header */
    header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 16px;
        background: var(--card-bg);
        padding: 12px;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow);
    }

    #current-month-year {
        font-size: 1.1rem;
        font-weight: 600;
        color: var(--text-primary);
    }

    .nav-btn {
        background: transparent;
        border: none;
        width: 32px;
        height: 32px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        color: var(--text-primary);
        transition: background 0.2s;
    }

    .nav-btn:hover {
        background-color: #f0f0f0;
    }

    .nav-btn:active {
        background-color: #e0e0e0;
    }

    /* Calendar Grid */
    .calendar-container {
        background: var(--card-bg);
        border-radius: var(--border-radius);
        padding: 16px;
        box-shadow: var(--shadow);
        flex-grow: 0;
    }

    .weekdays {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        text-align: center;
        margin-bottom: 8px;
    }

    .weekday {
        font-size: 0.8rem;
        font-weight: 600;
        color: var(--text-secondary);
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .days-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 4px;
    }

    .day {
        aspect-ratio: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        font-size: 0.95rem;
        cursor: pointer;
        transition: all 0.2s ease;
        position: relative;
    }

    .day:hover {
        background-color: #f0f0f0;
    }

    .day.padding {
        pointer-events: none;
    }

    .day.today {
        font-weight: 700;
        color: var(--accent);
        background-color: var(--accent-light);
    }

    .day.selected {
        background-color: var(--accent);
        color: white;
    }
    
    .day.has-note::after {
        content: '';
        position: absolute;
        bottom: 4px;
        width: 4px;
        height: 4px;
        background-color: var(--today-dot);
        border-radius: 50%;
    }
    
    .day.selected.has-note::after {
        background-color: white;
    }

    /* Event/Note Section */
    .note-section {
        margin-top: 16px;
        background: var(--card-bg);
        border-radius: var(--border-radius);
        padding: 16px;
        box-shadow: var(--shadow);
        flex-grow: 1;
        display: flex;
        flex-direction: column;
        min-height: 0; /* Important for flex scrolling */
    }

    .note-header {
        font-size: 0.9rem;
        font-weight: 600;
        color: var(--text-secondary);
        margin-bottom: 8px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    #note-date-display {
        color: var(--text-primary);
    }

    textarea#daily-note {
        width: 100%;
        flex-grow: 1;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        padding: 10px;
        font-family: inherit;
        font-size: 0.9rem;
        resize: none;
        outline: none;
        transition: border-color 0.2s;
        cursor: text;
        background: #fafafa;
    }

    textarea#daily-note:focus {
        border-color: var(--accent);
        background: white;
    }
    
    .action-row {
        margin-top: 8px;
        display: flex;
        justify-content: flex-end;
    }

    button.save-btn {
        background-color: var(--accent);
        color: white;
        border: none;
        padding: 6px 16px;
        border-radius: 6px;
        font-size: 0.85rem;
        font-weight: 600;
        cursor: pointer;
        transition: background 0.2s;
    }

    button.save-btn:hover {
        background-color: var(--accent-hover);
    }

    button.save-btn:active {
        transform: scale(0.96);
    }

    /* Mobile Mode Tweaks */
    body.mobile-mode .nav-btn {
        width: 44px;
        height: 44px;
    }

    body.mobile-mode .day {
        font-size: 1rem;
    }

    body.mobile-mode button.save-btn {
        padding: 10px 20px;
    }

    /* Animations */
    @keyframes fadein {
        from { opacity: 0; transform: translateY(5px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    .days-grid {
        animation: fadein 0.3s ease-out;
    }

</style>
</head>
<body>

<div id="app">
    <header>
        <button class="nav-btn" id="prev-month">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M15 18l-6-6 6-6"/></svg>
        </button>
        <div id="current-month-year"></div>
        <button class="nav-btn" id="next-month">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M9 18l6-6-6-6"/></svg>
        </button>
    </header>

    <div class="calendar-container">
        <div class="weekdays">
            <div class="weekday">S</div>
            <div class="weekday">M</div>
            <div class="weekday">T</div>
            <div class="weekday">W</div>
            <div class="weekday">T</div>
            <div class="weekday">F</div>
            <div class="weekday">S</div>
        </div>
        <div class="days-grid" id="calendar-days">
            <!-- JS Generated -->
        </div>
    </div>

    <div class="note-section">
        <div class="note-header">
            <span id="note-date-display">Select a date</span>
            <span id="save-status" style="font-size: 0.75rem; color: var(--accent); opacity: 0; transition: opacity 0.5s;">Saved</span>
        </div>
        <textarea id="daily-note" placeholder="Add a note for this day..."></textarea>
        <div class="action-row">
            <button class="save-btn" id="save-note-btn">Save Note</button>
        </div>
    </div>
</div>

<script>
    // Audio Context Setup
    const AudioContext = window.AudioContext || window.webkitAudioContext;
    let audioCtx;

    function initAudio() {
        if (!audioCtx) audioCtx = new AudioContext();
        if (audioCtx.state === 'suspended') audioCtx.resume();
    }

    function playSound(type) {
        initAudio();
        const osc = audioCtx.createOscillator();
        const gainNode = audioCtx.createGain();

        osc.connect(gainNode);
        gainNode.connect(audioCtx.destination);

        const now = audioCtx.currentTime;

        if (type === 'click') {
            osc.type = 'sine';
            osc.frequency.setValueAtTime(600, now);
            osc.frequency.exponentialRampToValueAtTime(300, now + 0.1);
            gainNode.gain.setValueAtTime(0.1, now);
            gainNode.gain.exponentialRampToValueAtTime(0.001, now + 0.1);
            osc.start(now);
            osc.stop(now + 0.1);
        } else if (type === 'pop') {
            osc.type = 'triangle';
            osc.frequency.setValueAtTime(400, now);
            gainNode.gain.setValueAtTime(0.1, now);
            gainNode.gain.exponentialRampToValueAtTime(0.001, now + 0.15);
            osc.start(now);
            osc.stop(now + 0.15);
        } else if (type === 'save') {
            osc.type = 'sine';
            osc.frequency.setValueAtTime(500, now);
            osc.frequency.setValueAtTime(800, now + 0.1);
            gainNode.gain.setValueAtTime(0.1, now);
            gainNode.gain.linearRampToValueAtTime(0, now + 0.3);
            osc.start(now);
            osc.stop(now + 0.3);
        }
    }

    // State
    let navDate = new Date(); // For month navigation
    let selectedDate = new Date(); // The actually selected day
    const months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
    
    // DOM Elements
    const monthYearDisplay = document.getElementById('current-month-year');
    const daysContainer = document.getElementById('calendar-days');
    const noteDateDisplay = document.getElementById('note-date-display');
    const noteTextarea = document.getElementById('daily-note');
    const saveBtn = document.getElementById('save-note-btn');
    const saveStatus = document.getElementById('save-status');

    // Storage Key
    const STORAGE_KEY = 'zen_calendar_notes';

    function getNotes() {
        try {
            return JSON.parse(localStorage.getItem(STORAGE_KEY)) || {};
        } catch {
            return {};
        }
    }

    function saveNoteToStorage(dateStr, text) {
        const notes = getNotes();
        if (text.trim() === "") {
            delete notes[dateStr];
        } else {
            notes[dateStr] = text;
        }
        localStorage.setItem(STORAGE_KEY, JSON.stringify(notes));
    }

    function getNoteForDate(dateStr) {
        const notes = getNotes();
        return notes[dateStr] || "";
    }

    function formatDateKey(date) {
        const y = date.getFullYear();
        const m = String(date.getMonth() + 1).padStart(2, '0');
        const d = String(date.getDate()).padStart(2, '0');
        return `${y}-${m}-${d}`;
    }

    function renderCalendar() {
        daysContainer.innerHTML = "";
        
        const year = navDate.getFullYear();
        const month = navDate.getMonth();

        monthYearDisplay.textContent = `${months[month]} ${year}`;

        const firstDayIndex = new Date(year, month, 1).getDay();
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        
        // Previous month padding
        const prevMonthDays = new Date(year, month, 0).getDate();
        for (let i = firstDayIndex; i > 0; i--) {
            const dayDiv = document.createElement('div');
            dayDiv.classList.add('day', 'padding');
            // dayDiv.innerText = prevMonthDays - i + 1; // Optional: show prev dates faded
            daysContainer.appendChild(dayDiv);
        }

        const today = new Date();
        const notes = getNotes();

        for (let i = 1; i <= daysInMonth; i++) {
            const dayDiv = document.createElement('div');
            dayDiv.classList.add('day');
            dayDiv.innerText = i;
            
            const currentIterDate = new Date(year, month, i);
            const dateKey = formatDateKey(currentIterDate);

            if (i === today.getDate() && month === today.getMonth() && year === today.getFullYear()) {
                dayDiv.classList.add('today');
            }

            if (selectedDate && 
                i === selectedDate.getDate() && 
                month === selectedDate.getMonth() && 
                year === selectedDate.getFullYear()) {
                dayDiv.classList.add('selected');
            }

            if (notes[dateKey]) {
                dayDiv.classList.add('has-note');
            }

            dayDiv.addEventListener('click', () => {
                playSound('pop');
                selectedDate = new Date(year, month, i);
                renderCalendar(); // Re-render to update selection
                loadNote();
            });

            daysContainer.appendChild(dayDiv);
        }

        // Trigger animation reset
        daysContainer.style.animation = 'none';
        daysContainer.offsetHeight; /* trigger reflow */
        daysContainer.style.animation = 'fadein 0.3s ease-out';
    }

    function loadNote() {
        const dateKey = formatDateKey(selectedDate);
        noteDateDisplay.textContent = selectedDate.toLocaleDateString(undefined, { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
        noteTextarea.value = getNoteForDate(dateKey);
    }

    // Event Listeners
    document.getElementById('prev-month').addEventListener('click', () => {
        playSound('click');
        navDate.setMonth(navDate.getMonth() - 1);
        renderCalendar();
    });

    document.getElementById('next-month').addEventListener('click', () => {
        playSound('click');
        navDate.setMonth(navDate.getMonth() + 1);
        renderCalendar();
    });

    saveBtn.addEventListener('click', () => {
        const dateKey = formatDateKey(selectedDate);
        saveNoteToStorage(dateKey, noteTextarea.value);
        playSound('save');
        renderCalendar(); // Update dots
        
        // Show saved toast
        saveStatus.style.opacity = 1;
        setTimeout(() => {
            saveStatus.style.opacity = 0;
        }, 1500);
    });

    // Check for mobile mode
    const observer = new MutationObserver((mutations) => {
        mutations.forEach((mutation) => {
            if (mutation.attributeName === "class") {
                // Resize logic could go here if needed, CSS handles most
            }
        });
    });
    observer.observe(document.body, { attributes: true });

    // Initial load
    renderCalendar();
    loadNote();

</script>
</body>
</html>